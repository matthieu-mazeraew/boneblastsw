<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../ifract/predict.css">
  <link rel="stylesheet" href="../ifract/style.css">
  <link rel="stylesheet" href="../ifract/queries.css">
  <link rel="stylesheet" href="../ifract/test.css">
  <!--<link rel="stylesheet" href="../ifract/bootstrap-5.0.0-beta2-dist/css/bootstrap.css">-->
  <!--<link rel="stylesheet" href="../ifract/fontawesome-free-5.15.2-web/css/all.css">-->
  <!--<script src="../ifract/scripts.js"></script>-->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <title>Bone Fracture Risk Calculator</title>
  <link rel="icon" href="../images/favicons.png"/>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
   integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">       
  <!--<link rel="stylesheet" href="ratingChart.css">-->
  <!--<link rel="stylesheet" href="fonts.css">-->

</head>

<body data-spy="scroll" data-target=".fixed-top">
</nav>
        <!-- Navigation -->
        <nav class="navbar fixed-top">
            <div class="container sm:px-4 lg:px-8 flex flex-wrap items-center justify-between lg:flex-nowrap">
                
                <!-- Text Logo - Use this if you don't have a graphic logo -->
                <!-- <a class="text-gray-800 font-semibold text-3xl leading-4 no-underline page-scroll" href="index.html">Pavo</a> -->

                <!-- Image Logo -->
                <a class="inline-block mr-4 py-0.5 text-xl whitespace-nowrap hover:no-underline focus:no-underline" href="../index.html">
                    <img src="../images/favicon.png" alt="alternative" class="h-8" width="50"/>
                </a>


                <a class="btn-solid-reg mr-1.5" href="../index.html">Back To Main Menu</a>

            
                </div> <!-- end of navbar-collapse -->
            </div> <!-- end of container -->
        </nav> <!-- end of navbar -->
        <!-- end of navigation -->

    <div id="pricing" class="cards-1">
        <header class="ex-header bg-gray">
            <div class="container mx-auto px-4 sm:px-8 xl:max-w-6xl xl:px-4">
                <h16 class="xl:ml-24">Skeletal Age Calculator</h16>
            </div> <!-- end of container -->
        </header> <!-- end of ex-header --> 
    </div>
   



  <div class="tool-bone" id="tool-bone" style="height: auto;">
    <div class="bone-page-form" id="bone-page-form">
      <div class="panel-light">
        <div class="form-group">
          <div class="name-input">
            <div class="form-group">
              <h3 class="lb-input">Full name <small>(optional)</small></h3>
              <input class="predict-input" id="name" type="text" style="width:12.75em;">
            </div>
          </div>
          <div class="name-input">
            <div class="form-group">
              <h3 class="lb-input age-lb" style="margin-left: 175px;">Age</h3>
              <input class="predict-input" type="number" id="age" name="age" min="50" max="96">
            </div>
          </div>
        </div>
        <div class="form-group">
          <h3 class="lb-input" style="margin-left: 160px;">Gender</h3>
            <input type="radio" id="wo" name="gender" value="wo" checked="true">
          <label class="radios_label wo-lb" for="wo">
            Female
          </label>  
          <input type="radio" id="men" name="gender" value="men">
          <label class="radios_label" for="men">
            Male
          </label>     
        </div>
        <div class="form-group">
          <h3 class="lb-input">Height <small>(centimetres)</small></h3>
          <input class="predict-input predict-input-5" type="number" name="height" id="height">
        </div>
        <div class="form-group">
          <h3 class="lb-input" style="margin-right: 27px;">Weight <small>(kilograms)</small></h3>
          <input class="predict-input predict-input-5" type="number" name="weight" id="weight">
        </div>
        <div class="form-group">
          <h3 class="lb-input" style="margin-left: 0px;">Charlson Comorbiditiy Index</h3>
          <input class="predict-input predict-input-5" type="number" autocomplete="off" name="CCI" id="CCI"
          min="0" max="10" placeholder="0 to 10">
        </div>
      </div>
      <div class="panel-light diseases">
        <div class="form-group">
          <h3>Charlson Comorbidity Index</h3>
          <div class="" style="display: flex; justify-content: space-between;">
            <div class="disea">
              <div class="mtop-20">
                <input type="checkbox" name="Congestive" id="Congestive" class="disease">
                <label class="">
                  Congestive heart failure
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Dementia" id="Dementia" class="disease">
                <label class="">
                  Dementia
                </label>
              </div>
             <div class="mtop-20">
              <input type="checkbox" name="Chronic" id="Chronic" class="disease">
              <label class="">
                Chronic pulmonary disease
              </label>
             </div>
              <div class="mtop-20">
                <input type="checkbox" name="Rheumatologic" id="Rheumatologic" class="disease">
                <label class="">
                  Rheumatologic disease
                </label>
              </div>
             <div class="mtop-20">
              <input type="checkbox" name="Mild" id="Mild" class="disease">
              <label class="">
                Mild liver disease
              </label>
             </div>
              <div class="mtop-20">
                <input type="checkbox" name="Diabetes" id="Diabetes" class="disease">
                <label class="">
                  Diabetes with chronic complications
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Hemiplegia" id="Hemiplegia" class="disease">
                <label class="">
                  Hemiplegia or paraplegia
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Renal" id="Renal" class="disease">
                <label class="">
                  Renal disease
                </label>
              </div>
             <div class="mtop-20">
              <input type="checkbox" name="Any_malignancy" id="Any_malignancy" class="disease">
              <label class="">
                Any malignancy, including leukemia and lymphoma
              </label>
             </div>
              <div class="mtop-20">
                <input type="checkbox" name="Moderate" id="Moderate" class="disease">
                <label class="">
                  Moderate or severe liver disease
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Metastatic" id="Metastatic" class="disease">
                <label class="">
                  Metastatic solid tumor
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="AIDS" id="AIDS" class="disease">
                <label class="">
                  AIDS/HIV
                </label>
              </div>        
            </div>
          </div>
        </div>
      </div>

      <div class="panel-light diseases">
        <div class="form-group">
          <h3>Fracture</h3>
          <div class="" style="display: flex; justify-content: space-between;">
            <div class="disea">
              <div class="mtop-20">
                <input type="checkbox" name="Smoking" id="Smoking" class="disease">
                <label class="">
                  Smoking
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Hip" id="Hip" class="disease">
                <label class="">
                  Hip
                </label>
              </div>
             <div class="mtop-20">
              <input type="checkbox" name="Pelvis" id="Pelvis" class="disease">
              <label class="">
                Pelvis
              </label>
             </div>
              <div class="mtop-20">
                <input type="checkbox" name="Femur" id="Femur" class="disease">
                <label class="">
                  Femur
                </label>
              </div>
             <div class="mtop-20">
              <input type="checkbox" name="Vertebrae" id="Vertebrae" class="disease">
              <label class="">
                Vertebrae
              </label>
             </div>
              <div class="mtop-20">
                <input type="checkbox" name="Humerus" id="Humerus" class="disease">
                <label class="">
                  Humerus
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Rib" id="Rib" class="disease">
                <label class="">
                  Rib
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Clavicle" id="Clavicle" class="disease">
                <label class="">
                  Clavicle
                </label>
              </div>
             <div class="mtop-20">
              <input type="checkbox" name="Tibia" id="Tibia" class="disease">
              <label class="">
                Tibia
              </label>
             </div>
              <div class="mtop-20">
                <input type="checkbox" name="Elbow" id="Elbow" class="disease">
                <label class="">
                  Elbow
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Forearm" id="Forearm" class="disease">
                <label class="">
                  Forearm
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Knee" id="Knee" class="disease">
                <label class="">
                  Knee
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Ankle" id="Ankle" class="disease">
                <label class="">
                  Ankle
                </label>
              </div>
             <div class="mtop-20">
              <input type="checkbox" name="Foot" id="Foot" class="disease">
              <label class="">
                Foot
              </label>
             </div>
              <div class="mtop-20">
                <input type="checkbox" name="Hand" id="Hand" class="disease">
                <label class="">
                  Hand
                </label>
              </div>
              <div class="mtop-20">
                <input type="checkbox" name="Wrist" id="Wrist" class="disease">
                <label class="">
                  Wrist
                </label>
              </div>            
            </div>
          </div>
        </div>
      </div>
      <div class="panel-light">
        <div class="form-group">
          <h3>Disclaimer</h3>
          <p>
            The results produced by our calculator should serve as a guide only.
            If concerned about your fracture risk, it is also important to consult your doctor or a bone specialist.
          </p>
          <div class="radios">
            <div class="radios-item">
              <input type="checkbox" name="disclaimer" id="disclaimer">
              <label for="check" style="margin-left: 10px; position: absolute;">I have read and understand the
                disclaimer</label>
            </div>
          </div>
        </div>
      </div>
      <div class="panel-lgith">
        <div class="warning hidden">
            <div id="text-err">
              Please fill or change in all the required fields with below condition.
              <ul>
                <li id="age-err">
                  Please check your age, it must be from 50 to 96
                </li>
                <li id="T-scr-err">
                  Please check T-score, it must be from -5 to 4
                </li>
                <li id="check-err">
                  Please read and accept the disclaimer in order to proceed.
                </li>
                <li id="bmd-err">
                  Please check actual BMD score, it must be from 0.1 to 2.0
                </li>
                <li id="wei-err">
                  Please check the weight number, it must be from 10 to 150.
                </li>
                <li id="T-scr-or-bmd">
                  Please fill the T-score OR actual BMD
                </li>
              </ul>
            </div>
          </div>
      </div>
      <button class="btn1" id="calculate-btn" onclick="Result()">
        Get your results
      </button>
    </div>
    <div class="result-page" id="result-page">
      <div id="first-chart" class="panel-light hidden">
        <div id="number-result"></div>
        <div id="number-result2"></div>
      </div>      
        
    <button onclick="window.print();" id="Print-btn" class="btn1 hidden">Print</button>
    </div>

</div>
</div>

</body>

<footer>
        <!-- Copyright -->
  <div class="copyright">
            <div class="container px-4 sm:px-8 lg:grid lg:grid-cols-3">
                <p class="pb-2 p-small statement"> © Web App Demo 2021</a></p>
            </div>
        <!-- end of container -->
  </div> <!-- end of copyright -->
        <!-- end of copyright -->
</footer>


<script>
    
   
    function bar()
     {
        var link = document.getElementById("nav-link");
        link.classList.add("show");      
     }
     function close2()
     {       
         document.getElementById("nav-link").classList.remove("show");
     }
   

    function Result() {

      var full_name  = document.getElementById("name").value;
      var age = document.getElementById("age").value;
          var CCI = document.getElementById("CCI").value;
          var wei = document.getElementById("weight").value;
          var height = document.getElementById("height").value;
          var checkbox = document.getElementById("disclaimer");

          var Smoking = document.getElementById("Smoking");
               if(Smoking.checked)
               {
                 var smoking = 1;
               }
               else
               {
                 smoking = 0;
               }
          var Hip = document.getElementById("Hip");          
               if(Hip.checked)
               {
                 var hip = 1;
               }
               else
               {
                 hip = 0;
               }

          var pel = document.getElementById("Pelvis");
                if(pel.checked)
                var pelvis = 1;
                else
                pelvis = 0;
          var fem = document.getElementById("Femur");
                if(fem.checked)
                var femur = 1;
                else
                femur = 0;

          var vert = document.getElementById("Vertebrae");
                if(vert.checked)
                var vertebrae = 1;
                else
                vertebrae = 0;

          var hume = document.getElementById("Humerus");
                if(hume.checked)
                var humerus = 1;
                else
                humerus = 0;
          var ri = document.getElementById("Rib");
                if(ri.checked)
                var rib = 1;
                else
                rib = 0;
          var clav = document.getElementById("Clavicle");
                if(clav.checked)
                var clavicle = 1;
                else
                clavicle = 0;

          var tib = document.getElementById("Tibia");
                if(tib.checked)
                var tibia = 1;
                else
                tibia = 0;

          var elb = document.getElementsByName("Elbow");
                if(elb.checked)
                var elbow = 1;
                else
                elbow = 0;

          var forea = document.getElementById("Forearm");
                if(forea.checked)
                var forearm = 1;
                else
                forearm = 0;

          var kne = document.getElementById("Knee");
                if(kne.checked)
                var knee = 1;
                else
                knee = 0;
          var ank = document.getElementById("Ankle");
                if(ank.checked)
                var ankle = 1;
                else
                ankle = 0;
          var fo = document.getElementById("Foot");
                if(fo.checked)
                var foot = 1;
                else
                foot = 0;
          var han = document.getElementById("Hand");
                if(han.checked)
                var hand = 1;
                else
                hand = 0;
          var wir = document.getElementById("Wrist");
                if(wir.checked)
                var wirst = 1;
                else
                wirst = 0;

          var testArr = [smoking, hip, pelvis, femur, vertebrae, humerus, clavicle, tibia, elbow, forearm,
        knee, ankle, foot, hand, wirst];

        console.log(testArr);
          console.log(hip);
          console.log(pelvis);
          console.log(femur);
          console.log(vertebrae);
          console.log(humerus);
          console.log(clavicle);
          console.log(tibia);
          console.log(elbow);
          console.log(forearm);
          console.log(knee);
          console.log(ankle);
          console.log(foot);
          console.log(hand);
          console.log(wirst);
          

          console.log(age);



          var height_m = height / 100;
         
          var ele = document.getElementsByName('gender');     
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                var gender = ele[i].value;
            }

          
              $('.warning').addClass('hidden');

           var BMI = (wei/(Math.pow(height_m,2))).toFixed(1);
           console.log("BMI is: ",BMI);
           var coef = 0.257*CCI + 0.01*BMI + 0.4733*smoking + 0.8547*hip + 0.8592*pelvis + 0.6919*femur + 0.6295*vertebrae + 0.4243*humerus 
           + 0.4268*rib + 0.4305*clavicle + 0.4354*tibia + 0.1147*elbow + 0.1038*forearm + 0.214*knee + 0.1372*ankle - 0.0017*foot - 0.2031*hand + 0.2071*wirst;
           console.log("COEF is", coef);

           //coef =2.813;
           var skel_age = (Math.log(coef.toFixed(1))/Math.log(1.1)) ;
           var real_age = skel_age + parseInt(age);

           //BMI = 20;
           //CCI = 5;
           //age = 70;
           //coef =2.813;
           var qx = [2.059, 0.175, 0.204, 0.033, 0.064, 0.032, 0.096, 0.094, 0.000, 0.000, 0.000, 0.000, 0.060, 0.151, 0.153, 0.185, 0.369, 0.437, 0.589, 0.445, 0.577, 0.579, 0.317, 0.476, 0.441, 0.713, 0.895, 0.477, 0.543, 0.611, 0.507, 0.638, 0.572, 0.740, 0.849, 0.620, 0.840, 0.729, 0.960, 0.771, 0.906, 1.306, 1.020, 1.419, 1.055, 1.160, 1.448, 1.782, 1.712, 2.112, 1.873, 2.174, 2.949, 2.198, 2.617, 3.138, 4.276, 4.323, 4.333, 5.031, 5.880, 5.611, 6.368, 7.896, 7.888, 8.288, 11.187, 12.640, 12.769, 13.729, 15.648, 16.632,  18.592, 20.907, 24.536, 27.730, 28.554, 30.961, 36.073, 41.158, 47.602, 51.960, 61.761, 66.589, 78.630, 92.359, 100.496, 112.117, 128.829, 151.725, 162.987, 179.113, 204.320, 222.943, 235.269, 245.015, 294.884, 340.168, 345.695, 350.626, 364.807, 350.383, 338.862, 283.469, 550.671, 435.282, 1000.000];

           var Lx1 = qx.map(function(x) { return x * 1; }); 
           var lx1 = qx.map(function(x) { return x * 1; }); 
           var Tx1 = qx.map(function(x) { return x * 1; }); 
           var Ex1 = qx.map(function(x) { return x * 1; }); 

           var Lx2 = qx.map(function(x) { return x * 1; }); 
           var lx2 = qx.map(function(x) { return x * 1; }); 
           var Tx2 = qx.map(function(x) { return x * 1; }); 
           var Ex2 = qx.map(function(x) { return x * 1; }); 

           var length = qx.length-2;

           Lx1[0] = 100000;
           Lx1[106] = 0;
           Tx1[106] = 0;
           Ex1[106] = 0;

           Lx2[0] = 100000;
           Lx2[106] = 0;
           Tx2[106] = 0;
           Ex2[106] = 0;

           //console.log("truoc vong for:",Lx1);
           for (let x=1; x<106; x++){
              Lx1[x] = Lx1[x-1]*(1-(qx[x-1]* 1.00/1000));
              Lx2[x] = Lx2[x-1]*(1-(qx[x-1]* Math.exp(coef)/1000));
            };

           //console.log("sau vong lap for:", Lx1);

           var Lx1_next = Lx1.map(function(x) { return x * 1; });
           Lx1_next.shift(); 
           console.log("sau shift:", Lx1_next);
           Lx1_next.push(0);
           console.log("sau push:", Lx1_next);
           lx1 = Lx1.map((a, i) => a*0.5 + Lx1_next[i]*0.5);

           lx1[105] = 0;
           lx1[106] = 0;
           //console.log("ket qua lx1",lx1);


           var Lx2_next = Lx2.map(function(x) { return x * 1; });
           Lx2_next.shift(); 
           Lx2_next.push(0);
           lx2 = Lx2.map((a, i) => a*0.5 + Lx2_next[i]*0.5);

           lx2[105] = 0;
           lx2[106] = 0;
           console.log("ket qua lx2",lx1);

           for (let x=0; x<106; x++){
              //Tx1[x] = lx1.reduce((a, b) => a + b, 0);
              Tx1[x] = lx1.slice(x,106).reduce((a, b) => a + b, 0);           
              //Tx2[x] = lx2.reduce((a, b) => a + b, 0);
              Tx2[x] = lx2.slice(x,106).reduce((a, b) => a + b, 0);   
            };

            console.log("ket qua Tx1",Tx1);
            console.log("ket qua Tx2",Tx2);

            Ex1 = Tx1.map((a, i) => a/Lx1[i]);
            //Ex2 = Tx2 / Lx2
            Ex2 = Tx2.map((a, i) => a/Lx2[i]);

            console.log("ket qua Ex1:",Ex1);

            //Lx1 = [round(x,2) for x in Lx1];
            for (let x=0; x<Lx1.length; x++){
              Lx1[x] = Math.round(Lx1[x] * 100) / 100
            };
           
            for (let x=0; x<lx1.length; x++){
              lx1[x] = Math.round(lx1[x] * 100) / 100
            };
            for (let x=0; x<Tx1.length; x++){
              Tx1[x] = Math.round(Tx1[x] * 100) / 100
            };
            for (let x=0; x<Ex1.length; x++){
              Ex1[x] = Math.round(Ex1[x] * 100) / 100
            };

            for (let x=0; x<Lx2.length; x++){
              Lx2[x] = Math.round(Lx2[x] * 100) / 100
            };
           
            for (let x=0; x<lx2.length; x++){
              lx2[x] = Math.round(lx2[x] * 100) / 100
            };
            for (let x=0; x<Tx2.length; x++){
              Tx2[x] = Math.round(Tx2[x] * 100) / 100
            };
            for (let x=0; x<Ex2.length; x++){
              Ex2[x] = Math.round(Ex2[x] * 100) / 100
            };

           //Diff = Ex1- Ex2
           var Diff = Ex1.map((a, i) => a - Ex2[i]);

          var Skel_Age2 = Diff.map((a, i) => a + parseInt(age));
          for (let x=0; x<Skel_Age2.length; x++){
              Skel_Age2[x] = Math.round(Skel_Age2[x] * 10) / 10
            };

          //var Skel_Age2_final = Skel_Age2[107- parseInt(age)];
          var Skel_Age2_final = Skel_Age2[parseInt(age)];

           console.log("Skel_Age2 ket qua:", Diff)
           console.log("Skel_Age2 ket qua:", Skel_Age2)
           console.log("Skel_Age2 ket qua:", Skel_Age2_final)
           console.log("COEF is", coef," -- BMI is: ",BMI , "-- CCI is: ",CCI);

           console.log("Theo công thức 1: ",real_age);
           document.getElementById("number-result").innerHTML  = "Your Skeletal Age is: " + real_age.toFixed(0);
           document.getElementById("number-result2").innerHTML = "Theo công thức 2: " + Skel_Age2_final;
           document.getElementById("result-page").classList.remove("hidden");
           document.getElementById("bone-page-form").classList.add("hidden");
           document.getElementById("first-chart").classList.remove("hidden");


           function sumArray(mang){
                let sum = 0;
                let i = 0;
                while (i < mang.length){
                    sum += mang[i];
                    i++;
                };
                return sum;
            };
               };
</script>

</html>
